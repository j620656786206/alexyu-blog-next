---
title: 將公司專案轉換成 Monorepo 遇到的那些事 - 第一篇 全面解析 Monorepo：解決跨專案管理的挑戰與效率提升秘訣
description: 探討從多儲存庫（Polyrepo）架構轉型為單一儲存庫（Monorepo）的過程、挑戰與解決方案，解析 Monorepo 在跨專案管理中的優勢。
date: 2024-11-25
slug: transfer-polyrepo-to-monorepo
type: Post
tags:
  - monorepo
  - polyrepo
  - monolith
  - 軟體架構
  - 程式碼管理
  - 開發效率
  - devOps
  - monorepo 工具
  - nx
  - 軟體開發
---

# 第一篇 全面解析 Monorepo：解決跨專案管理的挑戰與效率提升秘訣

## 什麼是 Monorepo？解決的問題與好處

在軟體開發的世界裡，專案的規模與複雜度越來越大，如何有效管理程式碼變得越來越重要。從版本控制的角度來看，我們可以採用不同的儲存庫策略來組織程式碼。其中，Monolith（單體式）、Polyrepo（多儲存庫） 和 Monorepo（單一儲存庫） 是最常見的三種方式。這篇文章將帶你了解它們的差異，並深入探討 Monorepo 的好處。

### Monolith（單體式儲存庫）

Monolith 是一種最傳統的程式碼管理方式，將所有功能與模組集中在一個 Repository(以下簡稱 Repo)中。這種方式的主要特點是：

1. 簡單維護：由於所有程式碼都在一個 Repo 中，版本控制和合併衝突相對容易處理。
2. 低靈活性：當專案規模增長時，單一 Repo 可能導致版本控制緩慢、構建時間變長，進而影響開發效率。
3. 擴展性不足：專案變得越來越龐大後，新增功能或模組需要花費更多時間和精力來確保與現有程式碼的整合。

### Polyrepo（多儲存庫）

為了解決單體式儲存庫在靈活性與擴展性上的不足，許多團隊採用了 Polyrepo 策略，將每個模組或功能分拆到獨立的 Repo 中。這種方式的主要特點是：

1. 團隊自主性：每個團隊可以根據需求自行管理自己的 Repo，採用不同的工具與流程。
2. 跨儲存庫挑戰：
   - 程式碼共享困難：當多個專案需要共用某些模組時，開發者必須額外處理程式碼的同步與版本控制。
   - 重複程式碼增多：由於儲存庫分散，無法方便地重用程式碼，往往導致不同 Repo 中出現類似的功能實現。
   - 工具與流程不一致：每個 Repo 可能使用不同的構建工具與測試框架，導致整體維護成本上升。

### Monorepo（單一儲存庫）

在上述兩種策略的基礎上，Monorepo 提供了一種兼具靈活性與效率的解決方案。Monorepo 將多個專案集中在同一個 Repo 中，並透過一套統一的工具與流程進行管理。這種方式並不僅僅是「把程式碼放在一起」，而是一種有結構的管理方式。它的優點包括：

#### 1. 簡化程式碼共享

- 在 Monorepo 中，共用模組或功能非常簡單，因為所有程式碼都在同一個 Repo 內。開發者只需要通過內部的函式庫引用即可，無需額外處理跨儲存庫的依賴問題。
- 不同專案間可以輕鬆共享相同的設定，例如 ESLint 規範、Prettier 格式化規則或 CI/CD 腳本。

#### 2. 提升效率

- 本地快取與分散式構建：透過工具（如 Nx）的支援，Monorepo 可以有效縮短構建時間，僅針對受影響的專案進行重建。
- 任務編排與自動化：Monorepo 工具可以智能地處理多個專案的依賴關係，確保執行任務的順序正確無誤。

#### 3. 減少重複程式碼

在 Polyrepo 中，由於缺乏共用的函式庫，開發者經常需要在多個儲存庫中複製相同的程式碼。Monorepo 消除了這種需求，通過集中管理大幅降低重複程式碼的風險。

#### 4. 增強團隊協作

- 開發者流動性：開發者在 Monorepo 中可以方便地切換到不同的專案，快速理解程式碼並開始貢獻。
- 原子性提交：跨多個專案的更改可以在一次提交中完成，避免了多儲存庫情況下的版本不一致問題。

#### Monorepo 的挑戰與誤解

雖然 Monorepo 擁有許多優點，但在實施過程中也會面臨一些挑戰。例如：

1. 程式碼量過大：當 Repo 規模非常龐大時，可能會導致版本控制工具（如 Git）的性能下降。不過，這些問題可以通過使用專門的工具（如 Nx 或 Bazel）解決。
2. 團隊擔憂：一些團隊可能會擔心 Monorepo 會影響自主性，但事實上，合理的權限管理與工具設計可以有效避免此問題。

## 我們曾面臨的問題

在過渡到 Monorepo 之前，我們使用的是多儲存庫（Polyrepo）策略，但這種策略給我們帶來了許多挑戰，包括：

1. 子模組的問題：子模組的維護非常困難，尤其是在處理版本更新和同步時。
2. 跨模組的共用功能修改與測試：需要修改共用模組時，必須同步更新多個 Repo，這增加了測試和整合的成本。
3. 本地開發體驗不佳：由於每個 Repo 都有不同的工具與流程，開發者需要花費額外的時間去適應。
4. 部署流程繁瑣：多儲存庫情況下，每個 Repo 都需要單獨部署，耗時且容易出錯。

# 總結

Monorepo 為軟體開發帶來了全新的可能性。它結合了單體式儲存庫的簡單與多儲存庫的靈活性，通過統一的工具與流程提升了效率並減少了重複勞動。雖然在實施過程中可能會遇到一些挑戰，但只要使用得當，Monorepo 將成為大型專案開發的不二選擇。在接下來的文章中，我們將探討如何將現有專案成功遷移到 Monorepo，以及使用 Nx 的最佳實踐，敬請期待！
